<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<title>Une image - Une histoire</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<meta name="description" content="Découvrez 'Une image - Une histoire' à partir des photographies de Francis de Faccio. Des histoires à suivre, immersives et des récits mystérieux." />
<meta name="keywords" content="science-fiction, animation, Francis de Faccio, histoire audio, fiction immersive, transmission, extraterrestre, photographie" />

<style>
  body { margin: 0; padding: 0; font-family: monospace; color: lime; background: black; text-align: center; }

  h1 { font-size: 3rem; margin: 40px 0 20px 0; color: #00ff80; }
  p.subtitle { font-size: 1.3rem; margin: 15px 0; color: #00ff80; }

  button, a#backPhoto {
    margin: 20px;
    padding: 10px 18px;
    font-size: 1rem;
    cursor: pointer;
    border: 1px solid #00ff80;
    border-radius: 6px;
    background: rgba(0,255,128,0.06);
    color: #00ff80;
    text-decoration: none;
    display: inline-block;
    transition: background .12s, color .12s;
  }
  button:hover, a#backPhoto:hover { background: #00ff80; color: #001; }

  .popup {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.95);
    z-index: 1000;
    overflow: hidden;
    align-items: stretch;
    justify-content: center;
  }

  .popup .bg {
    position: absolute;
    top: 50%;
    left: 50%;
    height: 100%;
    width: auto;
    transform: translate(-50%, -50%);
    object-fit: contain;
    filter: brightness(0.45);
    background-color: black;
    z-index: 1000;
  }

  .popup .text {
    position: absolute;
    bottom: 10%;
    left: 5%;
    right: 5%;
    text-align: center;
    font-size: clamp(1.2rem, 2.4vw, 2rem);
    letter-spacing: 0.12em;
    color: #00ff80;
    white-space: pre-wrap;
    z-index: 1002;
    opacity: 0;
  }

  .close-btn,
  .return-link {
    position: absolute;
    top: 2%;
    padding: 6px 10px;
    font-size: 1.05rem;
    border-radius: 6px;
    border: 1px solid #00ff80;
    background: rgba(0,255,128,0.06);
    color: #00ff80;
    text-decoration: none;
    cursor: pointer;
    z-index: 1003;
    transition: background .12s, color .12s;
  }
  .close-btn:hover,
  .return-link:hover { background: #00ff80; color: #001; }

  .close-btn { right: 2%; }
  .return-link { left: 2%; padding-left: 12px; padding-right: 12px; }

  .popup audio {
    position: absolute;
    bottom: 6%;
    left: 50%;
    transform: translateX(-50%);
    z-index: 1002;
    width: min(90%, 720px);
  }

  @media (max-width:600px){
    h1 { font-size: 2rem; margin: 25px 0 15px 0; }
    p.subtitle { font-size: 1rem; }
    .popup .text { font-size: 1.1rem; bottom: 12%; padding: 0 8px; }
    .close-btn, .return-link { font-size: 0.95rem; padding: 6px 8px; }
    button, a#backPhoto { font-size: 0.95rem; padding: 8px 16px; }
  }
</style>
</head>
<body>

<h1>Une image - Une histoire</h1>
<button id="btn1">▶ Épisode 1</button>
<button id="btn2">▶ Épisode 2</button>
<button id="btn3">▶ Épisode 3</button>
<button id="btn3b">▶ Épisode 3 bis</button>
<button id="btn4">▶ Épisode 4</button>
<p class="subtitle">Regardez, imaginez, suivez evzone.fr</p>
<p class="subtitle">Francis De Faccio propose un terrain de jeu pour votre imagination.</p>
<a id="backPhoto" href="photographie.html">← Retour page Photographie</a>

<!-- Popups existants -->
<div id="popup1" class="popup" aria-hidden="true" role="dialog"><a class="return-link" href="une_image_une_histoire.html">← Retour</a><button class="close-btn" id="closeBtn1">✖</button><img class="bg" src="images/episodes/episode1/ta_photo_heure_bleue.jpg" alt="Fond épisode 1" /><div class="text" id="text1"></div><audio id="audio1" preload="auto"></audio></div>

<div id="popup2" class="popup" aria-hidden="true" role="dialog"><a class="return-link" href="une_image_une_histoire.html">← Retour</a><button class="close-btn" id="closeBtn2">✖</button><img class="bg" src="images/episodes/episode2/episode_02-gouffre-de-padirac.jpg" alt="Fond épisode 2" /><div class="text" id="text2"></div><audio id="audio2" preload="auto"></audio></div>

<div id="popup3" class="popup" aria-hidden="true" role="dialog"><a class="return-link" href="une_image_une_histoire.html">← Retour</a><button class="close-btn" id="closeBtn3">✖</button><img class="bg" src="images/episodes/episode3/mont_gargan.jpg" alt="Fond épisode 3" /><div class="text" id="text3"></div><audio id="audio3" preload="auto"></audio></div>

<div id="popup3b" class="popup" aria-hidden="true" role="dialog"><a class="return-link" href="une_image_une_histoire.html">← Retour</a><button class="close-btn" id="closeBtn3b">✖</button><img class="bg" src="images/episodes/episode3_bis/cloche.jpg" alt="Fond épisode 3 bis" /><div class="text" id="text3b"></div><audio id="audio3b" preload="auto"></audio></div>

<!-- === NOUVEL ÉPISODE 4 === -->
<div id="popup4" class="popup" aria-hidden="true" role="dialog">
  <a class="return-link" href="une_image_une_histoire.html">← Retour</a>
  <button class="close-btn" id="closeBtn4">✖</button>
  <img class="bg" src="images/episodes/episode4/chapelle_rocamadour.jpg" alt="Chapelle de Rocamadour" />
  <div class="text" id="text4"></div>
  <audio id="audio4" preload="auto"></audio>
</div>

<script>
// Épisodes et sons existants
const scenarios1 = [
  ">>> Transmission Alien activée…\n>>> Coordonnées 45.540210, 1.520049\n>>> Tour de surveillance repérée à 535m d’altitude\n>>> Panorama stratégique confirmé\n>>> Ouverture du canal niveau 1...",
  ">>> Signal retrouvé…\n>>> Balise terrienne dissimulée dans la tour…\n>>> Les anciens observateurs ont quitté la zone.\n>>> Notre surveillance reprend.",
  ">>> Scan atmosphérique en cours…\n>>> Résonance détectée : heure bleue\n>>> La tour diffuse\n>>> Connexion activée\n>>> Transmission...",
  ">>> Point stratégique identifié : Tour de Masseret\n>>> Altitude 535m : visibilité totale\n>>> Secteurs : Millevaches, Monédières\n>>> Surveillance engagée…",
  ">>> Accès mémoire : Table d’orientation terrienne\n>>> observation du ciel\n>>> altitude 535m",
  ">>> Transmission en clair : pour ceux qui lisent\n>>> La tour de Masseret est un phare entre deux mondes\n>>> ouverture du passage\n>>> RDV au sommet"
];
const sounds1 = ["images/episodes/episode1/contact_balise.wav","images/episodes/episode1/son_episode1.wav"];

const scenarios2 = [
  ">>> Ce point d’accès détecté se nommait Gouffre de Padirac\n>>> Structures métalliques terriennes confirmées\n>>> Nous progressons dans la profondeur\n>>> Transmission : le passage mène encore plus bas",
  ">>> Archive terrienne : année 1889\n>>> Edouard-Alfred Martel part à la découverte du Gouffre de Padirac\n>>> Descente des premiers humains par corde\n>>> Ils ne savaient pas ce qui les attendait\n>>> construction métallique 36 mètres, octobre 1898",
  ">>> L’ouverture du gouffre : Portail entre deux mondes ?\n>>> Chaque goutte d’eau, une onde de passage\n>>> Sommes-nous vraiment seuls ici ?",
  ">>> Balise détectée : signal intermittent\n>>> Les terriens pensaient visiter une curiosité\n>>> En réalité, ils approcheront une base\n>>> Activité confirmée sous le niveau zéro"
];
const sounds2 = [
  "images/episodes/episode2/01_sonepisode2.mp3",
  "images/episodes/episode2/enter-the-cave.mp3",
  "images/episodes/episode2/explorers.mp3",
  "images/episodes/episode2/low-spaceship.mp3",
  "images/episodes/episode2/oscillating.mp3",
  "images/episodes/episode2/space-trave.mp3"
];

const scenarios3 = [">>> Activité cosmique détectée\n>>> Alignement : Mont Gargan ↔ Voie lactée"];
const sounds3 = ["images/episodes/episode3/son_mont_gargan.mp3"];

const scenarios3b = [">>> la cloche du Mont Gargan\n>>> cet artefact rayonne sur toute la vallée"];
const sounds3b = ["images/episodes/episode3_bis/cloche.mp3"];

// --- NOUVEL ÉPISODE 4 --- 
const scenarios4 = [
  ">>> la chapelle s’ouvre sur la Voie Sainte de 216 marches\n>>> abritée sous le rocher\n>>> alors la statue de la Vierge Noire apparaît",
  ">>> il n’y a plus d’épée visible aujourd’hui\n>>> plus de traces fiables\n>>> mais la légende imprègne le lieu"
];
const sounds4 = [
  "images/episodes/episode4/rocamadour01.mp3",
  "images/episodes/episode4/rocamadour02.mp3",
  "images/episodes/episode4/rocamadour03.mp3",
  "images/episodes/episode4/rocamadour04.mp3",
  "images/episodes/episode4/rocamadour05.mp3"
];

// --- Fonction principale ---
function openPopup(n, scenarios, sounds) {
  const pop = document.getElementById("popup" + n);
  const audio = document.getElementById("audio" + n);
  const txtElem = document.getElementById("text" + n);
  if (!pop || !txtElem || !audio) return;

  const text = scenarios[Math.floor(Math.random() * scenarios.length)];
  txtElem.textContent = "";
  txtElem.style.opacity = 1;

  audio.src = sounds[Math.floor(Math.random() * sounds.length)];
  audio.play().catch(()=>{});

  pop.style.display = "flex";
  pop.setAttribute('aria-hidden','false');

  const lettreSound = new Audio("images/interface/lettre.mp3");
  const retourSound = new Audio("images/interface/retour.mp3");

  let i = 0;
  function step() {
    if (i < text.length) {
      txtElem.textContent = text.slice(0, i+1);

      const char = text[i];
      if (char === "\n") {
        retourSound.currentTime = 0;
        retourSound.play().catch(()=>{});
      } else {
        lettreSound.currentTime = 0;
        lettreSound.play().catch(()=>{});
      }

      i++;
      setTimeout(step, 80);
    }
  }
  step();
}

function closePopup(n) {
  const pop = document.getElementById("popup" + n);
  const audio = document.getElementById("audio" + n);
  const txtElem = document.getElementById("text" + n);
  if (audio) { audio.pause(); audio.currentTime = 0; }
  if (pop) { pop.style.display = "none"; pop.setAttribute('aria-hidden','true'); }
  if (txtElem) txtElem.textContent = "";
}

// --- boutons ---
document.getElementById("btn1").addEventListener('click', ()=> openPopup(1, scenarios1, sounds1));
document.getElementById("btn2").addEventListener('click', ()=> openPopup(2, scenarios2, sounds2));
document.getElementById("btn3").addEventListener('click', ()=> openPopup(3, scenarios3, sounds3));
document.getElementById("btn3b").addEventListener('click', ()=> openPopup("3b", scenarios3b, sounds3b));
document.getElementById("btn4").addEventListener('click', ()=> openPopup(4, scenarios4, sounds4));

document.getElementById("closeBtn1").addEventListener('click', ()=> closePopup(1));
document.getElementById("closeBtn2").addEventListener('click', ()=> closePopup(2));
document.getElementById("closeBtn3").addEventListener('click', ()=> closePopup(3));
document.getElementById("closeBtn3b").addEventListener('click', ()=> closePopup("3b"));
document.getElementById("closeBtn4").addEventListener('click', ()=> closePopup(4));

window.addEventListener('keydown', (e)=>{
  if (e.key === "Escape") {
    closePopup(1); closePopup(2); closePopup(3); closePopup("3b"); closePopup(4);
  }
});
</script>
</body>
</html>
